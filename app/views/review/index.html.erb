<%== s = Markup.new

@last = nil

s.h2 "Task: #{@task.name}"

s/ "#{@task.pending_photo_ids.size} photos pending."
s/ link_to('reload', nil, {:id=>'reload_link'})
s.div(:class=>:clear)

@photos.each do |foto|
		
	s/ div(:id=>"foto_#{foto.id}", :class=>"foto foto_#{foto.id} #{foto.status}") {
		case foto.status
		when 'approved'
			s/ link_to(image_tag(foto.url, :class=>'image'), foto.url, {:target=>'_blank'} )
			s/ 'preapproved'
		when 'rejected'
			s/ link_to(image_tag(foto.url, :class=>'image'), foto.url, {:target=>'_blank'} )
			s/ 'REJECTED'
		else
			s/ link_to(image_tag(foto.url, :class=>'image', :onerror=>remote_function(:url=>{:action=>'reject', :id=>foto.id, :borken=>1})), foto.url, {:target=>'_blank'} )
			s/ link_to_remote('REJECT', {:url=>{:action=>'reject', :id=>foto.id}}, {:class=>'small'} )
		end
		s/ ctag('a', :href=>url_for(:action=>'approve', :id=>foto.id), :class=>'ok_link')
	}
	
end

s.div(:class=>:clear)
s/ '<br>'*2
s/ link_to_function('APPROVE REMAINING', "$$('.ok_link').each(function(s) { new Ajax.Request(s.href); }); $('dismiss_link').remove(); new Ajax.Request('/review/next_page', { onSuccess: function(response) { window.location.reload(); } });", :id=>'dismiss_link') unless @photos.empty?
s 
%>

